<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Using Fixed Effects Models to Fight Endogeneity in Panel Data and Difference–in–Difference Models | R Companion to Real Econometrics</title>
  <meta name="description" content="This book looks at the R code necessary to complete the end of chapter exercises in Bailey’s Real Econometrics" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Using Fixed Effects Models to Fight Endogeneity in Panel Data and Difference–in–Difference Models | R Companion to Real Econometrics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book looks at the R code necessary to complete the end of chapter exercises in Bailey’s Real Econometrics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Using Fixed Effects Models to Fight Endogeneity in Panel Data and Difference–in–Difference Models | R Companion to Real Econometrics" />
  
  <meta name="twitter:description" content="This book looks at the R code necessary to complete the end of chapter exercises in Bailey’s Real Econometrics" />
  

<meta name="author" content="Tony Carilli" />


<meta name="date" content="2019-09-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chp7.html"/>
<link rel="next" href="chp9.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Companion to *Real Econometrics*</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#install-r-and-rstudio"><i class="fa fa-check"></i><b>2.1</b> Install R and RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#using-rstudio"><i class="fa fa-check"></i><b>2.2</b> Using RStudio</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#source-pane"><i class="fa fa-check"></i><b>2.2.1</b> Source Pane</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#environmenthistory-pane"><i class="fa fa-check"></i><b>2.2.2</b> Environment/History Pane</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#console-pane"><i class="fa fa-check"></i><b>2.2.3</b> Console Pane</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#filesplotspackageshelp-pane"><i class="fa fa-check"></i><b>2.2.4</b> Files/Plots/Packages/Help Pane</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#r-markdown"><i class="fa fa-check"></i><b>2.3</b> R Markdown</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chp1.html"><a href="chp1.html"><i class="fa fa-check"></i><b>3</b> The Quest for Causality</a><ul>
<li class="chapter" data-level="3.1" data-path="chp1.html"><a href="chp1.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="3.1.1" data-path="chp1.html"><a href="chp1.html#table-1.1"><i class="fa fa-check"></i><b>3.1.1</b> Table 1.1</a></li>
<li class="chapter" data-level="3.1.2" data-path="chp1.html"><a href="chp1.html#figure-1.2"><i class="fa fa-check"></i><b>3.1.2</b> Figure 1.2</a></li>
<li class="chapter" data-level="3.1.3" data-path="chp1.html"><a href="chp1.html#figure-1.3"><i class="fa fa-check"></i><b>3.1.3</b> Figure 1.3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chp2.html"><a href="chp2.html"><i class="fa fa-check"></i><b>4</b> Stats in the Wild: Good Data Practices</a><ul>
<li class="chapter" data-level="4.1" data-path="chp2.html"><a href="chp2.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="chp2.html"><a href="chp2.html#table-and-figure-reproduction"><i class="fa fa-check"></i><b>4.2</b> Table and Figure Reproduction</a><ul>
<li class="chapter" data-level="4.2.1" data-path="chp2.html"><a href="chp2.html#table-2.1"><i class="fa fa-check"></i><b>4.2.1</b> Table 2.1</a></li>
<li class="chapter" data-level="4.2.2" data-path="chp2.html"><a href="chp2.html#table-2.2"><i class="fa fa-check"></i><b>4.2.2</b> Table 2.2</a></li>
<li class="chapter" data-level="4.2.3" data-path="chp2.html"><a href="chp2.html#table-2.5"><i class="fa fa-check"></i><b>4.2.3</b> Table 2.5</a></li>
<li class="chapter" data-level="4.2.4" data-path="chp2.html"><a href="chp2.html#figure-2.3"><i class="fa fa-check"></i><b>4.2.4</b> Figure 2.3</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="chp2.html"><a href="chp2.html#computing-center"><i class="fa fa-check"></i><b>4.3</b> Computing Center</a><ul>
<li class="chapter" data-level="4.3.1" data-path="chp2.html"><a href="chp2.html#reading-data"><i class="fa fa-check"></i><b>4.3.1</b> Reading Data</a></li>
<li class="chapter" data-level="4.3.2" data-path="chp2.html"><a href="chp2.html#manually-entering-data"><i class="fa fa-check"></i><b>4.3.2</b> Manually Entering Data</a></li>
<li class="chapter" data-level="4.3.3" data-path="chp2.html"><a href="chp2.html#simple-statistics"><i class="fa fa-check"></i><b>4.3.3</b> Simple Statistics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cph3.html"><a href="cph3.html"><i class="fa fa-check"></i><b>5</b> Bivariate OLS: The Foundation of Econometric Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="cph3.html"><a href="cph3.html#estimating-a-simple-regression"><i class="fa fa-check"></i><b>5.1</b> Estimating a simple regression</a></li>
<li class="chapter" data-level="5.2" data-path="cph3.html"><a href="cph3.html#scatter-plot-with-regression-line"><i class="fa fa-check"></i><b>5.2</b> scatter Plot with Regression Line</a></li>
<li class="chapter" data-level="5.3" data-path="cph3.html"><a href="cph3.html#subsetting-data-for-regressions"><i class="fa fa-check"></i><b>5.3</b> Subsetting Data for Regressions</a></li>
<li class="chapter" data-level="5.4" data-path="cph3.html"><a href="cph3.html#heteroscesdasticity-consistent-standard-errors."><i class="fa fa-check"></i><b>5.4</b> Heteroscesdasticity-consistent standard errors.</a></li>
<li class="chapter" data-level="5.5" data-path="cph3.html"><a href="cph3.html#generating-random-numbers"><i class="fa fa-check"></i><b>5.5</b> Generating Random Numbers</a></li>
<li class="chapter" data-level="5.6" data-path="cph3.html"><a href="cph3.html#simulations"><i class="fa fa-check"></i><b>5.6</b> Simulations</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chp4.html"><a href="chp4.html"><i class="fa fa-check"></i><b>6</b> Hypothesis Testing and Interval Estimation; Answering Research Questions</a><ul>
<li class="chapter" data-level="6.1" data-path="chp4.html"><a href="chp4.html#computing-corner"><i class="fa fa-check"></i><b>6.1</b> Computing Corner</a><ul>
<li class="chapter" data-level="6.1.1" data-path="chp4.html"><a href="chp4.html#probability-distributions-in-r"><i class="fa fa-check"></i><b>6.1.1</b> Probability Distributions in R</a></li>
<li class="chapter" data-level="6.1.2" data-path="chp4.html"><a href="chp4.html#critical-values-in-r"><i class="fa fa-check"></i><b>6.1.2</b> Critical Values in R</a></li>
<li class="chapter" data-level="6.1.3" data-path="chp4.html"><a href="chp4.html#confidence-intervals-for-ols-estimates"><i class="fa fa-check"></i><b>6.1.3</b> Confidence Intervals for OLS estimates</a></li>
<li class="chapter" data-level="6.1.4" data-path="chp4.html"><a href="chp4.html#power-curves"><i class="fa fa-check"></i><b>6.1.4</b> Power Curves</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chp5.html"><a href="chp5.html"><i class="fa fa-check"></i><b>7</b> Multivariate OLS: Where the Action Is</a><ul>
<li class="chapter" data-level="7.1" data-path="chp5.html"><a href="chp5.html#computing-corner-1"><i class="fa fa-check"></i><b>7.1</b> Computing Corner</a><ul>
<li class="chapter" data-level="7.1.1" data-path="chp5.html"><a href="chp5.html#multiple-regression"><i class="fa fa-check"></i><b>7.1.1</b> Multiple Regression</a></li>
<li class="chapter" data-level="7.1.2" data-path="chp5.html"><a href="chp5.html#multicollinearity"><i class="fa fa-check"></i><b>7.1.2</b> Multicollinearity</a></li>
<li class="chapter" data-level="7.1.3" data-path="chp5.html"><a href="chp5.html#standardized-coefficients"><i class="fa fa-check"></i><b>7.1.3</b> Standardized Coefficients</a></li>
<li class="chapter" data-level="7.1.4" data-path="chp5.html"><a href="chp5.html#f-tests"><i class="fa fa-check"></i><b>7.1.4</b> <em>F</em> tests</a></li>
<li class="chapter" data-level="7.1.5" data-path="chp5.html"><a href="chp5.html#examples"><i class="fa fa-check"></i><b>7.1.5</b> Examples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chp6.html"><a href="chp6.html"><i class="fa fa-check"></i><b>8</b> Dummy Variables: Smarter than You Think</a><ul>
<li class="chapter" data-level="8.1" data-path="chp6.html"><a href="chp6.html#dummy-variables-in-r"><i class="fa fa-check"></i><b>8.1</b> Dummy Variables in R</a><ul>
<li class="chapter" data-level="8.1.1" data-path="chp6.html"><a href="chp6.html#factors"><i class="fa fa-check"></i><b>8.1.1</b> Factors</a></li>
<li class="chapter" data-level="8.1.2" data-path="chp6.html"><a href="chp6.html#character-vectors-as-dummies"><i class="fa fa-check"></i><b>8.1.2</b> Character Vectors as Dummies</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="chp6.html"><a href="chp6.html#difference-in-means-test"><i class="fa fa-check"></i><b>8.2</b> Difference in Means Test</a><ul>
<li class="chapter" data-level="8.2.1" data-path="chp6.html"><a href="chp6.html#using-t.test"><i class="fa fa-check"></i><b>8.2.1</b> Using <code>t.test</code></a></li>
<li class="chapter" data-level="8.2.2" data-path="chp6.html"><a href="chp6.html#using-lm-and-lm_robust"><i class="fa fa-check"></i><b>8.2.2</b> Using <code>lm</code> and <code>lm_robust</code></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="chp6.html"><a href="chp6.html#integer-and-numerical-vectors-as-dummy-variables"><i class="fa fa-check"></i><b>8.3</b> Integer and Numerical Vectors as Dummy Variables</a></li>
<li class="chapter" data-level="8.4" data-path="chp6.html"><a href="chp6.html#manipulating-factors"><i class="fa fa-check"></i><b>8.4</b> Manipulating Factors</a></li>
<li class="chapter" data-level="8.5" data-path="chp6.html"><a href="chp6.html#dummy-interaction-variables"><i class="fa fa-check"></i><b>8.5</b> Dummy Interaction Variables</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chp7.html"><a href="chp7.html"><i class="fa fa-check"></i><b>9</b> Specifying Models</a><ul>
<li class="chapter" data-level="9.1" data-path="chp7.html"><a href="chp7.html#polynomial-models"><i class="fa fa-check"></i><b>9.1</b> Polynomial Models</a></li>
<li class="chapter" data-level="9.2" data-path="chp7.html"><a href="chp7.html#logarithmic"><i class="fa fa-check"></i><b>9.2</b> Logarithmic</a><ul>
<li class="chapter" data-level="9.2.1" data-path="chp7.html"><a href="chp7.html#constant-elasticity-log-log-or-double-log"><i class="fa fa-check"></i><b>9.2.1</b> Constant Elasticity (log-log or double log)</a></li>
<li class="chapter" data-level="9.2.2" data-path="chp7.html"><a href="chp7.html#constant-growth-in-a-dependent-variable-log-lin-or-semilog"><i class="fa fa-check"></i><b>9.2.2</b> Constant Growth in a Dependent Variable (log-lin or semilog)</a></li>
<li class="chapter" data-level="9.2.3" data-path="chp7.html"><a href="chp7.html#constant-change-in-dependent-variable-lin-log"><i class="fa fa-check"></i><b>9.2.3</b> Constant % Change in Dependent Variable (lin-log)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="chp7.html"><a href="chp7.html#other-useful-functional-forms"><i class="fa fa-check"></i><b>9.3</b> Other Useful Functional Forms</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chp8.html"><a href="chp8.html"><i class="fa fa-check"></i><b>10</b> Using Fixed Effects Models to Fight Endogeneity in Panel Data and Difference–in–Difference Models</a><ul>
<li class="chapter" data-level="10.1" data-path="chp8.html"><a href="chp8.html#simpsons-paradox"><i class="fa fa-check"></i><b>10.1</b> Simpson’s Paradox</a></li>
<li class="chapter" data-level="10.2" data-path="chp8.html"><a href="chp8.html#figures-8.1-8.3"><i class="fa fa-check"></i><b>10.2</b> Figures 8.1-8.3</a></li>
<li class="chapter" data-level="10.3" data-path="chp8.html"><a href="chp8.html#one-way-fixed-effects-models"><i class="fa fa-check"></i><b>10.3</b> One-Way Fixed Effects Models</a><ul>
<li class="chapter" data-level="10.3.1" data-path="chp8.html"><a href="chp8.html#lsdv-approach"><i class="fa fa-check"></i><b>10.3.1</b> LSDV Approach</a></li>
<li class="chapter" data-level="10.3.2" data-path="chp8.html"><a href="chp8.html#f-test-for-significance-of-fixed-effects."><i class="fa fa-check"></i><b>10.3.2</b> <em>F</em>-test for significance of fixed effects.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="chp8.html"><a href="chp8.html#de-meaned-approach"><i class="fa fa-check"></i><b>10.4</b> De-Meaned approach</a><ul>
<li class="chapter" data-level="10.4.1" data-path="chp8.html"><a href="chp8.html#manually-de-mean"><i class="fa fa-check"></i><b>10.4.1</b> Manually De-Mean</a></li>
<li class="chapter" data-level="10.4.2" data-path="chp8.html"><a href="chp8.html#using-the-plm-package"><i class="fa fa-check"></i><b>10.4.2</b> Using the <code>plm</code> package</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="chp8.html"><a href="chp8.html#two-way-fixed-effects-models"><i class="fa fa-check"></i><b>10.5</b> Two-Way Fixed Effects Models</a><ul>
<li class="chapter" data-level="10.5.1" data-path="chp8.html"><a href="chp8.html#time-as-a-factor"><i class="fa fa-check"></i><b>10.5.1</b> Time as a factor</a></li>
<li class="chapter" data-level="10.5.2" data-path="chp8.html"><a href="chp8.html#effect-twoways"><i class="fa fa-check"></i><b>10.5.2</b> effect = “twoways”</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="chp8.html"><a href="chp8.html#difference-in-difference-models"><i class="fa fa-check"></i><b>10.6</b> Difference-in-Difference Models</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chp9.html"><a href="chp9.html"><i class="fa fa-check"></i><b>11</b> Instrumental Variables: Using Exogenous Variation to Fight Endogeneity</a><ul>
<li class="chapter" data-level="11.1" data-path="chp9.html"><a href="chp9.html#stage-least-squares"><i class="fa fa-check"></i><b>11.1</b> 2 Stage Least Squares</a></li>
<li class="chapter" data-level="11.2" data-path="chp9.html"><a href="chp9.html#explanatory-power-of-the-instruments"><i class="fa fa-check"></i><b>11.2</b> Explanatory power of the instruments</a></li>
<li class="chapter" data-level="11.3" data-path="chp9.html"><a href="chp9.html#estimating-simultaneous-equation-model"><i class="fa fa-check"></i><b>11.3</b> Estimating Simultaneous Equation Model</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chp10.html"><a href="chp10.html"><i class="fa fa-check"></i><b>12</b> Experiments: Dealing with Real–World Challenges</a><ul>
<li class="chapter" data-level="12.1" data-path="chp10.html"><a href="chp10.html#assess-balance"><i class="fa fa-check"></i><b>12.1</b> Assess Balance</a></li>
<li class="chapter" data-level="12.2" data-path="chp10.html"><a href="chp10.html#estimate-itt-model"><i class="fa fa-check"></i><b>12.2</b> Estimate ITT Model</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chp11.html"><a href="chp11.html"><i class="fa fa-check"></i><b>13</b> Regression Discontinuity: Looking for Jumps in Data</a><ul>
<li class="chapter" data-level="13.1" data-path="chp11.html"><a href="chp11.html#same-slope"><i class="fa fa-check"></i><b>13.1</b> Same slope</a></li>
<li class="chapter" data-level="13.2" data-path="chp11.html"><a href="chp11.html#varying-slopes"><i class="fa fa-check"></i><b>13.2</b> Varying Slopes</a></li>
<li class="chapter" data-level="13.3" data-path="chp11.html"><a href="chp11.html#plot-rd-model"><i class="fa fa-check"></i><b>13.3</b> Plot RD Model</a></li>
<li class="chapter" data-level="13.4" data-path="chp11.html"><a href="chp11.html#rddtools-package"><i class="fa fa-check"></i><b>13.4</b> <code>rddtools</code> package</a><ul>
<li class="chapter" data-level="13.4.1" data-path="chp11.html"><a href="chp11.html#same-slope-1"><i class="fa fa-check"></i><b>13.4.1</b> Same slope</a></li>
<li class="chapter" data-level="13.4.2" data-path="chp11.html"><a href="chp11.html#varying-slopes-1"><i class="fa fa-check"></i><b>13.4.2</b> Varying Slopes</a></li>
<li class="chapter" data-level="13.4.3" data-path="chp11.html"><a href="chp11.html#scatter-plot"><i class="fa fa-check"></i><b>13.4.3</b> Scatter Plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="chp12.html"><a href="chp12.html"><i class="fa fa-check"></i><b>14</b> Dummy Dependent Variables</a><ul>
<li class="chapter" data-level="14.1" data-path="chp12.html"><a href="chp12.html#probit-estimation"><i class="fa fa-check"></i><b>14.1</b> Probit Estimation</a><ul>
<li class="chapter" data-level="14.1.1" data-path="chp12.html"><a href="chp12.html#eda"><i class="fa fa-check"></i><b>14.1.1</b> EDA</a></li>
<li class="chapter" data-level="14.1.2" data-path="chp12.html"><a href="chp12.html#estimate-the-model"><i class="fa fa-check"></i><b>14.1.2</b> Estimate the model</a></li>
<li class="chapter" data-level="14.1.3" data-path="chp12.html"><a href="chp12.html#estimated-effects"><i class="fa fa-check"></i><b>14.1.3</b> Estimated Effects</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="chp12.html"><a href="chp12.html#logit-estimation"><i class="fa fa-check"></i><b>14.2</b> Logit Estimation</a><ul>
<li class="chapter" data-level="14.2.1" data-path="chp12.html"><a href="chp12.html#discrete-differences"><i class="fa fa-check"></i><b>14.2.1</b> Discrete Differences</a></li>
<li class="chapter" data-level="14.2.2" data-path="chp12.html"><a href="chp12.html#marginal-effects-1"><i class="fa fa-check"></i><b>14.2.2</b> Marginal Effects</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="chp12.html"><a href="chp12.html#testing-hypotheses"><i class="fa fa-check"></i><b>14.3</b> Testing Hypotheses</a></li>
<li class="chapter" data-level="14.4" data-path="chp12.html"><a href="chp12.html#graphing-probit-and-logit-models"><i class="fa fa-check"></i><b>14.4</b> Graphing Probit and Logit Models</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="chp13.html"><a href="chp13.html"><i class="fa fa-check"></i><b>15</b> Time Series: Dealing with Stickiness over Time</a><ul>
<li class="chapter" data-level="15.1" data-path="chp13.html"><a href="chp13.html#time-series-objects-in-r"><i class="fa fa-check"></i><b>15.1</b> Time Series Objects in R</a></li>
<li class="chapter" data-level="15.2" data-path="chp13.html"><a href="chp13.html#detecting-autocorrelation"><i class="fa fa-check"></i><b>15.2</b> Detecting Autocorrelation</a></li>
<li class="chapter" data-level="15.3" data-path="chp13.html"><a href="chp13.html#correcting-autocorrelation"><i class="fa fa-check"></i><b>15.3</b> Correcting Autocorrelation</a><ul>
<li class="chapter" data-level="15.3.1" data-path="chp13.html"><a href="chp13.html#newey-west"><i class="fa fa-check"></i><b>15.3.1</b> Newey-West</a></li>
<li class="chapter" data-level="15.3.2" data-path="chp13.html"><a href="chp13.html#cochrane-orcutt"><i class="fa fa-check"></i><b>15.3.2</b> Cochrane-Orcutt</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="chp13.html"><a href="chp13.html#dynamic-models"><i class="fa fa-check"></i><b>15.4</b> Dynamic Models</a></li>
<li class="chapter" data-level="15.5" data-path="chp13.html"><a href="chp13.html#dickey-fuller-test"><i class="fa fa-check"></i><b>15.5</b> Dickey-Fuller Test</a></li>
<li class="chapter" data-level="15.6" data-path="chp13.html"><a href="chp13.html#first-differencing"><i class="fa fa-check"></i><b>15.6</b> First Differencing</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="chp14.html"><a href="chp14.html"><i class="fa fa-check"></i><b>16</b> Advanced OLS</a><ul>
<li class="chapter" data-level="16.1" data-path="chp14.html"><a href="chp14.html#derive-ols-estimator-matrix-form"><i class="fa fa-check"></i><b>16.1</b> Derive OLS estimator (Matrix Form)</a><ul>
<li class="chapter" data-level="16.1.1" data-path="chp14.html"><a href="chp14.html#example"><i class="fa fa-check"></i><b>16.1.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="chp14.html"><a href="chp14.html#gaussmarkov-theorem"><i class="fa fa-check"></i><b>16.2</b> Gauss–Markov Theorem</a><ul>
<li class="chapter" data-level="16.2.1" data-path="chp14.html"><a href="chp14.html#ols-estimator-is-linear"><i class="fa fa-check"></i><b>16.2.1</b> OLS estimator is linear</a></li>
<li class="chapter" data-level="16.2.2" data-path="chp14.html"><a href="chp14.html#ols-estimator-is-unbiased"><i class="fa fa-check"></i><b>16.2.2</b> OLS estimator is unbiased</a></li>
<li class="chapter" data-level="16.2.3" data-path="chp14.html"><a href="chp14.html#variance-covariance-is-a-minimum"><i class="fa fa-check"></i><b>16.2.3</b> Variance-Covariance is a minimum</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="chp14.html"><a href="chp14.html#probability-distributions-in-r-1"><i class="fa fa-check"></i><b>16.3</b> Probability Distributions in R</a><ul>
<li class="chapter" data-level="16.3.1" data-path="chp14.html"><a href="chp14.html#obtaining-critical-statistics"><i class="fa fa-check"></i><b>16.3.1</b> Obtaining Critical Statistics</a></li>
<li class="chapter" data-level="16.3.2" data-path="chp14.html"><a href="chp14.html#generating-random-numbers-1"><i class="fa fa-check"></i><b>16.3.2</b> Generating Random Numbers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="chp15.html"><a href="chp15.html"><i class="fa fa-check"></i><b>17</b> Advanced Panel Data</a><ul>
<li class="chapter" data-level="17.1" data-path="chp15.html"><a href="chp15.html#the-data"><i class="fa fa-check"></i><b>17.1</b> The Data</a></li>
<li class="chapter" data-level="17.2" data-path="chp15.html"><a href="chp15.html#variation-within-units"><i class="fa fa-check"></i><b>17.2</b> Variation within Units</a></li>
<li class="chapter" data-level="17.3" data-path="chp15.html"><a href="chp15.html#two-way-fixed-effects-model"><i class="fa fa-check"></i><b>17.3</b> Two-Way Fixed Effects Model</a></li>
<li class="chapter" data-level="17.4" data-path="chp15.html"><a href="chp15.html#testing-for-autocorrelation"><i class="fa fa-check"></i><b>17.4</b> Testing for autocorrelation</a></li>
<li class="chapter" data-level="17.5" data-path="chp15.html"><a href="chp15.html#estimating-hatrho"><i class="fa fa-check"></i><b>17.5</b> Estimating <span class="math inline">\(\hat\rho\)</span></a></li>
<li class="chapter" data-level="17.6" data-path="chp15.html"><a href="chp15.html#estimate-a-rho-transformed-model"><i class="fa fa-check"></i><b>17.6</b> Estimate a <span class="math inline">\(\rho\)</span>-Transformed Model</a></li>
<li class="chapter" data-level="17.7" data-path="chp15.html"><a href="chp15.html#lagged-dependent-variable-panel-data-model"><i class="fa fa-check"></i><b>17.7</b> Lagged Dependent Variable Panel Data Model</a></li>
<li class="chapter" data-level="17.8" data-path="chp15.html"><a href="chp15.html#random-effects-model"><i class="fa fa-check"></i><b>17.8</b> Random Effects Model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Companion to <em>Real Econometrics</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chp8" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> Using Fixed Effects Models to Fight Endogeneity in Panel Data and Difference–in–Difference Models</h1>
<p>In this chapter we will learn to deal with panel data in R. Panel data are data that include observations in and through time. Panel data combine aspects of cross–sectional data with time–series data. The libraries necessary for this chapter are:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb237-2" title="2"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb237-3" title="3"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb237-4" title="4"><span class="kw">library</span>(estimatr)</a>
<a class="sourceLine" id="cb237-5" title="5"><span class="kw">library</span>(carData)</a></code></pre></div>
<div id="simpsons-paradox" class="section level2">
<h2><span class="header-section-number">10.1</span> Simpson’s Paradox</h2>
<p>Simpson’s paradox - Simpson (<a href="https://www.jstor.org/stable/2984065?seq=1#metadata_info_tab_contents">1951</a>) is phenomenon where an apparent relationship between two variables reverses itself when the data are dis-aggregated. For example, let’s look at the admissions rate for men and women in the University of California at Berkeley admissions data.</p>
<p>UCBAdmissions is a cross-tabulation of 4526 applicants by 3 variables: Admit, Gender, and Dept, the number of observations for each is n stored as 3-dimensional array.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" title="1">UCBAdmissions</a></code></pre></div>
<pre><code>, , Dept = A

          Gender
Admit      Male Female
  Admitted  512     89
  Rejected  313     19

, , Dept = B

          Gender
Admit      Male Female
  Admitted  353     17
  Rejected  207      8

, , Dept = C

          Gender
Admit      Male Female
  Admitted  120    202
  Rejected  205    391

, , Dept = D

          Gender
Admit      Male Female
  Admitted  138    131
  Rejected  279    244

, , Dept = E

          Gender
Admit      Male Female
  Admitted   53     94
  Rejected  138    299

, , Dept = F

          Gender
Admit      Male Female
  Admitted   22     24
  Rejected  351    317</code></pre>
<p>To calculate admission rates, we need to create a new variable, apps, that is the sum of admitted and rejected apps for both men and women.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" title="1">UCBAdmissions <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb240-2" title="2"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># convert the table to a data frame</span></a>
<a class="sourceLine" id="cb240-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(Dept, Gender) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># allows us to sum admitted and rejected by department</span></a>
<a class="sourceLine" id="cb240-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">apps =</span> <span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># create number of applicants by department</span></a>
<a class="sourceLine" id="cb240-5" title="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># return the full data frame</span></a>
<a class="sourceLine" id="cb240-6" title="6"><span class="st">  </span><span class="kw">filter</span>(Admit <span class="op">==</span><span class="st"> &quot;Admitted&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># select only those applicants admitted</span></a>
<a class="sourceLine" id="cb240-7" title="7"><span class="st">  </span><span class="kw">group_by</span>(Gender) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># allows us to calculate acceptance rates by gender</span></a>
<a class="sourceLine" id="cb240-8" title="8"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">rate =</span> <span class="kw">sum</span>(n)<span class="op">/</span><span class="kw">sum</span>(apps))</a></code></pre></div>
<pre><code># A tibble: 2 x 2
  Gender  rate
  &lt;chr&gt;  &lt;dbl&gt;
1 Female 0.304
2 Male   0.445</code></pre>
<p>Males are accepted at rate of 44.5% while females are accepted at lower rate of 30.4%.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" title="1">UCBAdmissions <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-2" title="2"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(Dept, Gender) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb242-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">apps =</span> <span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-5" title="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-6" title="6"><span class="st">  </span><span class="kw">filter</span>(Admit <span class="op">==</span><span class="st"> &quot;Admitted&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-7" title="7"><span class="st">  </span><span class="kw">group_by</span>(Dept, Gender) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-8" title="8"><span class="st">  </span><span class="kw">summarize</span>(n<span class="op">/</span>apps)</a></code></pre></div>
<pre><code># A tibble: 12 x 3
# Groups:   Dept [6]
   Dept  Gender `n/apps`
   &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
 1 A     Female   0.824 
 2 A     Male     0.621 
 3 B     Female   0.68  
 4 B     Male     0.630 
 5 C     Female   0.341 
 6 C     Male     0.369 
 7 D     Female   0.349 
 8 D     Male     0.331 
 9 E     Female   0.239 
10 E     Male     0.277 
11 F     Female   0.0704
12 F     Male     0.0590</code></pre>
<p>We now see that females are admitted at higher rates to four of the six departments.</p>
</div>
<div id="figures-8.1-8.3" class="section level2">
<h2><span class="header-section-number">10.2</span> Figures 8.1-8.3</h2>
<p>We see a similar effect in Figures 8.1-8.3 in the text. We can reproduce those graphs with the code below. The crime data set contains observations on 19 variables from 58 cities over the period 1972 to 1993. First choose observations for only the California cities of Fresno, Los Angeles, Oakland, Sacramento, and San Francisco. Next convert the robbery and police to numbers per 1000 persons. The data frame crime contains the data.# the %in% operator means match the elements in one vector with elements in another.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb244-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># choose relevant variables</span></a>
<a class="sourceLine" id="cb244-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># choose relevant cities</span></a>
<a class="sourceLine" id="cb244-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># convert to per 1000</span></a>
<a class="sourceLine" id="cb244-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> policesworn, <span class="dt">y =</span> robbery)) <span class="op">+</span></a>
<a class="sourceLine" id="cb244-6" title="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> T) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb244-7" title="7"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> lm, <span class="dt">na.rm =</span> T, <span class="dt">se =</span> F) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb244-8" title="8"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Police per 1000 People&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb244-9" title="9"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Robberies per 1000 People&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb244-10" title="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">&quot;Figure 8.1: Robberies and Police for Large Cities in California&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># create caption</span></a>
<a class="sourceLine" id="cb244-11" title="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.caption =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>)) <span class="co"># left justify the caption</span></a></code></pre></div>
<p><img src="bailey_files/figure-html/figure8.1-1.png" width="672" /></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> policesworn, <span class="dt">y =</span> robbery, <span class="dt">color =</span> cityname)) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-6" title="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> T) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-7" title="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Police per 1000 People&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-8" title="8"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Robberies per 1000 People&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-9" title="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">&quot;Figure 8.2: Robberies and Police for Specified Cities in California&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-10" title="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.caption =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>), <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># remove legend</span></a>
<a class="sourceLine" id="cb245-11" title="11"><span class="st">  </span><span class="co"># place city names with corresponding colors.</span></a>
<a class="sourceLine" id="cb245-12" title="12"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">1.6</span>, <span class="dt">y =</span> <span class="dv">10</span>, <span class="dt">label =</span> <span class="st">&quot;Oakland&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#00BF7D&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-13" title="13"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">5</span>, <span class="dt">label =</span> <span class="st">&quot;Sacramento&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#00B0F6&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-14" title="14"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">2.58</span>, <span class="dt">y =</span> <span class="fl">4.5</span>, <span class="dt">label =</span> <span class="st">&quot;Los Angeles&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#A3A500&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-15" title="15"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">2.7</span>, <span class="dt">y =</span> <span class="fl">7.8</span>, <span class="dt">label =</span> <span class="st">&quot;San Francisco&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#E76BF3&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-16" title="16"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">1.25</span>, <span class="dt">y =</span> <span class="fl">3.5</span>, <span class="dt">label =</span> <span class="st">&quot;Fresno&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#F8766D&quot;</span>)</a></code></pre></div>
<p><img src="bailey_files/figure-html/figure8.2-1.png" width="672" /></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> policesworn, <span class="dt">y =</span> robbery, <span class="dt">color =</span> cityname)) <span class="op">+</span></a>
<a class="sourceLine" id="cb246-6" title="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> T) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-7" title="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Police per 1000 People&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-8" title="8"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Robberies per 1000 People&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb246-9" title="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">&quot;Figure 8.3: Robberies and Police for Specified Cities in California with City-Specific Regression Lines&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-10" title="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.caption =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>), <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-11" title="11"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">1.6</span>, <span class="dt">y =</span> <span class="dv">10</span>, <span class="dt">label =</span> <span class="st">&quot;Oakland&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#00BF7D&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-12" title="12"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">5</span>, <span class="dt">label =</span> <span class="st">&quot;Sacramento&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#00B0F6&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-13" title="13"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">2.58</span>, <span class="dt">y =</span> <span class="fl">4.5</span>, <span class="dt">label =</span> <span class="st">&quot;Los Angeles&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#A3A500&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-14" title="14"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">2.7</span>, <span class="dt">y =</span> <span class="fl">7.8</span>, <span class="dt">label =</span> <span class="st">&quot;San Francisco&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#E76BF3&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-15" title="15"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">1.25</span>, <span class="dt">y =</span> <span class="fl">3.5</span>, <span class="dt">label =</span> <span class="st">&quot;Fresno&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#F8766D&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb246-16" title="16"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> F) <span class="co"># add regression lines. the addition of the color aesthetic will cause geom_smooth to add regression lines for each &quot;color&quot;</span></a></code></pre></div>
<p><img src="bailey_files/figure-html/figure8.3-1.png" width="672" /></p>
</div>
<div id="one-way-fixed-effects-models" class="section level2">
<h2><span class="header-section-number">10.3</span> One-Way Fixed Effects Models</h2>
<div id="lsdv-approach" class="section level3">
<h3><span class="header-section-number">10.3.1</span> LSDV Approach</h3>
<p>The least squares dummy variable approach allows us to account for the fixed effects by including a dummy variable for each unit. First, let’s calculate the pooled model.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb247-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb247-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb247-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>) <span class="op">%$%</span></a>
<a class="sourceLine" id="cb247-5" title="5"><span class="st">  </span><span class="kw">lm</span>(robbery <span class="op">~</span><span class="st"> </span>policesworn) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb247-6" title="6"><span class="st">  </span><span class="kw">tidy</span>()</a></code></pre></div>
<pre><code># A tibble: 2 x 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)     3.48     1.05       3.31 0.00129 
2 policesworn     1.76     0.509      3.46 0.000771</code></pre>
<p>We can see that the coefficient on the police variable is positive and significantly different than zero.</p>
<p>To apply LSDV approach in R, we add cityname as an explanatory variable. Since cityname is a character vector, R will treat it as a factor.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb249-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb249-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb249-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>) <span class="op">%$%</span></a>
<a class="sourceLine" id="cb249-5" title="5"><span class="st">  </span><span class="kw">lm</span>(robbery <span class="op">~</span><span class="st"> </span>policesworn <span class="op">+</span><span class="st"> </span>cityname) </a></code></pre></div>
<pre><code>
Call:
lm(formula = robbery ~ policesworn + cityname)

Coefficients:
     (Intercept)       policesworn  citynamelosangel   citynameoakland  
           10.93             -4.16              6.60              5.96  
citynamesacramen   citynamesanfran  
            1.63              8.32  </code></pre>
<p>We can confirm that below.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb251-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb251-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb251-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb251-5" title="5">         <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb251-6" title="6">         <span class="dt">cityname =</span> <span class="kw">as_factor</span>(cityname)) <span class="op">%$%</span><span class="st"> </span><span class="co"># coerce cityname to a factor</span></a>
<a class="sourceLine" id="cb251-7" title="7"><span class="st">  </span><span class="kw">lm</span>(robbery <span class="op">~</span><span class="st"> </span>policesworn <span class="op">+</span><span class="st"> </span>cityname) </a></code></pre></div>
<pre><code>
Call:
lm(formula = robbery ~ policesworn + cityname)

Coefficients:
     (Intercept)       policesworn  citynamelosangel   citynameoakland  
           10.93             -4.16              6.60              5.96  
citynamesacramen   citynamesanfran  
            1.63              8.32  </code></pre>
<p>The equation for each city is:
<span class="math display">\[\text{Fresno: }Robbery = 8.79-2.75Police\]</span>
<span class="math display">\[\text{Los Angeles: }Robbery = 17.53-2.75Police\]</span>
<span class="math display">\[\text{Oakland: }Robbery = 16.89-2.75Police\]</span>
<span class="math display">\[\text{Sacramento: }Robbery = 12.56-2.75Police\]</span>
<span class="math display">\[\text{San Francisco: }Robbery = 19.25-2.75Police\]</span>
We see the effect of Simpson’s Paradox in the slope variable here. The slope variable is now negative and significant. It should be noted that these results are not consistent with Figure 8.3. Here we have only one slope coefficient with five different intercepts; Figure 8.3 shows five different slope coefficients along with five different intercepts. We can return results consistent with Figure 8.3 as below. We can show the equation for each of the five cities by adding the coefficient on the dummy variable to the intercept with the base case being Fresno<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb253-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb253-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb253-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb253-5" title="5">         <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb253-6" title="6">         <span class="dt">cityname =</span> <span class="kw">as_factor</span>(cityname)) <span class="op">%$%</span><span class="st"> </span><span class="co"># coerce cityname to a factor</span></a>
<a class="sourceLine" id="cb253-7" title="7"><span class="st">  </span><span class="kw">lm</span>(robbery <span class="op">~</span><span class="st"> </span>policesworn <span class="op">*</span><span class="st"> </span>cityname) </a></code></pre></div>
<pre><code>
Call:
lm(formula = robbery ~ policesworn * cityname)

Coefficients:
                 (Intercept)                   policesworn  
                       8.786                        -2.754  
            citynamelosangel               citynameoakland  
                      19.679                         3.720  
            citynamesacramen               citynamesanfran  
                       6.522                         4.442  
policesworn:citynamelosangel   policesworn:citynameoakland  
                      -6.038                         0.992  
policesworn:citynamesacramen   policesworn:citynamesanfran  
                      -2.940                         0.923  </code></pre>
<p>Now the equation for each city requires that we add the slope dummy coefficient to the intercept coefficient and the interaction coefficient to the coefficient on policesworn. So the equation for each city is:<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<p><span class="math display">\[\text{Fresno: }Robbery = 8.79-2.75Police\]</span>
<span class="math display">\[\text{Los Angeles: }Robbery=28.46-8.79Police\]</span>
<span class="math display">\[\text{Oakland: }Robbery=12.51-1.76Police\]</span>
<span class="math display">\[\text{Sacramento: }Robbery=15.31-5.69Police\]</span>
<span class="math display">\[\text{San Francisco: }Robbery=13.23-1.83Police\]</span></p>
<p>The above equation are consistent with the regression lines in Figure 8.3.</p>
</div>
<div id="f-test-for-significance-of-fixed-effects." class="section level3">
<h3><span class="header-section-number">10.3.2</span> <em>F</em>-test for significance of fixed effects.</h3>
<p>The unrestricted model is given by:<span class="math display">\[Y_{it}=\beta_0+\beta_1X_{1it}+\beta_2D_{1i}+\beta_3D_{2i}+\cdots+\beta_PD_{P-1,i}+\nu_{it}\]</span> To test for the significance of fixed effects we test the following hypothesis: <span class="math display">\[H_0:\beta_2=\beta_3=\cdots=\beta_P\]</span> <span class="math display">\[H_1: \text{@ least one }\beta\ne0\]</span> As in Chapter 5, we will make use of <code>linearHypothesis</code> from the car package.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" title="1"><span class="kw">library</span>(car)</a>
<a class="sourceLine" id="cb255-2" title="2">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-3" title="3"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-4" title="4"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb255-6" title="6">         <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb255-7" title="7">         <span class="dt">cityname =</span> <span class="kw">as_factor</span>(cityname)) <span class="op">%$%</span><span class="st"> </span><span class="co"># coerce cityname to a factor</span></a>
<a class="sourceLine" id="cb255-8" title="8"><span class="st">  </span><span class="kw">lm</span>(robbery <span class="op">~</span><span class="st"> </span>policesworn <span class="op">+</span><span class="st"> </span>cityname) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-9" title="9"><span class="st">  </span><span class="kw">linearHypothesis</span>(<span class="kw">c</span>(<span class="st">&quot;citynamelosangel = 0&quot;</span>, <span class="co"># use the variable names from the lm object</span></a>
<a class="sourceLine" id="cb255-10" title="10">                     <span class="st">&quot;citynameoakland = 0&quot;</span>, </a>
<a class="sourceLine" id="cb255-11" title="11">                     <span class="st">&quot;citynamesacramen = 0&quot;</span>, </a>
<a class="sourceLine" id="cb255-12" title="12">                     <span class="st">&quot;citynamesanfran = 0&quot;</span> ))</a></code></pre></div>
<pre><code>Linear hypothesis test

Hypothesis:
citynamelosangel = 0
citynameoakland = 0
citynamesacramen = 0
citynamesanfran = 0

Model 1: restricted model
Model 2: robbery ~ policesworn + cityname

  Res.Df RSS Df Sum of Sq    F              Pr(&gt;F)    
1    108 571                                          
2    104 194  4       377 50.6 &lt;0.0000000000000002 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Since the reported <em>F</em>-stat is 50.626 with a <em>p-value</em> of 0, we will reject the null hypothesis of no fixed effects in favor of the alternative suggesting that fixed effects exist.</p>
</div>
</div>
<div id="de-meaned-approach" class="section level2">
<h2><span class="header-section-number">10.4</span> De-Meaned approach</h2>
<div id="manually-de-mean" class="section level3">
<h3><span class="header-section-number">10.4.1</span> Manually De-Mean</h3>
<p>We can estimate the fixed-model with a de-meaned approach with the model: <span class="math display">\[Y_{it}-\bar Y_{i.}=\beta_1(X_{it}-\bar X_{i.})\]</span></p>
<p><code>scale</code> will de-mean the data with the argument <code>scale = F</code>. Learn more about <code>scale</code> by calling <code>?scale</code>. Do de-mean the data by city will use <code>group_by</code> in our pipeline to group the data by city, then we will <code>mutate</code> the crime and police variables with <code>scale</code> to de-mean them. We should end up the same estimate of the slope coefficient from the LSDV approach.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb257-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb257-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb257-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb257-5" title="5">         <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb257-6" title="6">         <span class="dt">cityname =</span> <span class="kw">as_factor</span>(cityname)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-7" title="7"><span class="st">  </span><span class="kw">group_by</span>(cityname) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb257-8" title="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery =</span> <span class="kw">scale</span>(robbery, <span class="dt">scale =</span> F),</a>
<a class="sourceLine" id="cb257-9" title="9">         <span class="dt">policesworn =</span> <span class="kw">scale</span>(policesworn, <span class="dt">scale =</span> F)) <span class="op">%$%</span></a>
<a class="sourceLine" id="cb257-10" title="10"><span class="st">  </span><span class="kw">lm</span>(robbery <span class="op">~</span><span class="st"> </span>policesworn) </a></code></pre></div>
<pre><code>
Call:
lm(formula = robbery ~ policesworn)

Coefficients:
          (Intercept)            policesworn  
 0.000000000000000609  -4.160101927269632682  </code></pre>
<p>The slope coefficient is the same as the slope coefficient estimated by LSDV.</p>
</div>
<div id="using-the-plm-package" class="section level3">
<h3><span class="header-section-number">10.4.2</span> Using the <code>plm</code> package</h3>
<p>We can estimate the fixed effects model with <code>plm</code> from the <code>plm</code> package. The <code>plm</code> package was created to make the estimation of linear panel models straightforward. To learn more read the <code>vignette(plmPackage)</code>. To estimate the one-way fixed effects model with <code>plm</code>, we need four arguments<code>formula</code>, <code>data</code>, <code>index</code>, and <code>model</code>. The <code>formula</code> and <code>data</code> arguments are the same as those in the <code>lm</code> call. <code>index</code> is a vector of the units and the type of variation is invoked with <code>model</code>. We estimate the model below:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" title="1"><span class="kw">library</span>(plm)  </a>
<a class="sourceLine" id="cb259-2" title="2">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-3" title="3"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-4" title="4"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb259-6" title="6">         <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb259-7" title="7">         <span class="dt">cityname =</span> <span class="kw">as_factor</span>(cityname)) -&gt;<span class="st"> </span><span class="co"># the %$% pipe does not function with plm</span></a>
<a class="sourceLine" id="cb259-8" title="8"><span class="st">  </span>cali <span class="co"># the modified data are assigned to the object cali</span></a>
<a class="sourceLine" id="cb259-9" title="9">  <span class="kw">plm</span>(robbery <span class="op">~</span><span class="st"> </span>policesworn, <span class="dt">data =</span> cali, <span class="dt">index =</span> <span class="st">&quot;cityname&quot;</span>, <span class="dt">model =</span> <span class="st">&quot;within&quot;</span>)</a></code></pre></div>
<pre><code>
Model Formula: robbery ~ policesworn

Coefficients:
policesworn 
      -4.16 </code></pre>
<p>Again, we get the same estimate of the slope coefficient.</p>
</div>
</div>
<div id="two-way-fixed-effects-models" class="section level2">
<h2><span class="header-section-number">10.5</span> Two-Way Fixed Effects Models</h2>
<p>The two-way fixed effects model is given by:<span class="math display">\[Y_{it}=\beta_0+\beta_1X_{1it}+\alpha_i+\tau_t+\nu_{it}\]</span></p>
<p>So we need to incorporate time into the one-way fixed effects model. This can be accomplished in one of two ways. Time can be treated as a factor (dummy variable) or set the effect in <code>plm</code> to <code>"twoways"</code>. The results will be the same.</p>
<div id="time-as-a-factor" class="section level3">
<h3><span class="header-section-number">10.5.1</span> Time as a factor</h3>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb261-5" title="5">         <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb261-6" title="6">         <span class="dt">cityname =</span> <span class="kw">as_factor</span>(cityname)) -&gt;<span class="st"> </span><span class="co"># the %$% pipe does not function with plm</span></a>
<a class="sourceLine" id="cb261-7" title="7"><span class="st">  </span>cali <span class="co"># the modified data are assigned to the object cali</span></a>
<a class="sourceLine" id="cb261-8" title="8">  <span class="kw">plm</span>(robbery <span class="op">~</span><span class="st"> </span>policesworn <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(year), <span class="dt">data =</span> cali, <span class="dt">index =</span> <span class="st">&quot;cityname&quot;</span>, <span class="dt">model =</span> <span class="st">&quot;within&quot;</span>)</a></code></pre></div>
<pre><code>
Model Formula: robbery ~ policesworn + factor(year)

Coefficients:
   policesworn factor(year)72 factor(year)73 factor(year)74 factor(year)75 
        -1.945         -0.493         -0.220         -0.158          0.647 
factor(year)76 factor(year)77 factor(year)78 factor(year)79 factor(year)80 
         0.872          0.789          1.476          1.545          2.831 
factor(year)81 factor(year)82 factor(year)83 factor(year)84 factor(year)85 
         2.509          1.940          1.151          0.782          1.005 
factor(year)86 factor(year)87 factor(year)88 factor(year)89 factor(year)90 
         1.361          0.109          0.140          0.574          1.432 
factor(year)91 factor(year)92 
         2.394          3.373 </code></pre>
</div>
<div id="effect-twoways" class="section level3">
<h3><span class="header-section-number">10.5.2</span> effect = “twoways”</h3>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" title="1">crime <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-2" title="2"><span class="st">  </span><span class="kw">select</span>(cityname, policesworn, robbery, popcity, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-3" title="3"><span class="st">  </span><span class="kw">filter</span>(cityname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fresno&quot;</span>, <span class="st">&quot;losangel&quot;</span>, <span class="st">&quot;oakland&quot;</span>, <span class="st">&quot;sacramen&quot;</span>, <span class="st">&quot;sanfran&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robbery=</span>robbery<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb263-5" title="5">         <span class="dt">policesworn =</span> policesworn<span class="op">/</span>popcity<span class="op">*</span><span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb263-6" title="6">         <span class="dt">cityname =</span> <span class="kw">as_factor</span>(cityname)) -&gt;<span class="st"> </span><span class="co"># the %$% pipe does not function with plm</span></a>
<a class="sourceLine" id="cb263-7" title="7"><span class="st">  </span>cali <span class="co"># the modified data are assigned to the object cali</span></a>
<a class="sourceLine" id="cb263-8" title="8">  <span class="kw">plm</span>(robbery <span class="op">~</span><span class="st"> </span>policesworn, <span class="dt">data =</span> cali, <span class="dt">index =</span> <span class="st">&quot;cityname&quot;</span>, <span class="dt">model =</span> <span class="st">&quot;within&quot;</span>, <span class="dt">effect =</span> <span class="st">&quot;twoways&quot;</span>)</a></code></pre></div>
<pre><code>
Model Formula: robbery ~ policesworn

Coefficients:
policesworn 
      -1.94 </code></pre>
<p>As expected, the coefficient on the police variable is the same in each case.</p>
</div>
</div>
<div id="difference-in-difference-models" class="section level2">
<h2><span class="header-section-number">10.6</span> Difference-in-Difference Models</h2>
<p>In 1992 New Jersey raised it’s minimum wage from $4.25 to $5.05 while neighboring Pennsylvania did not. We can use a difference-in-difference model to investigate the effect of the treatment (increase in minimum wage) on the effect full time employment. The <code>PoEdata</code><a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> package contains a data set named <code>njmin3</code> that has 820 observations on 14 variables, call <code>?njmin</code> for more information.</p>
<p>Estimate the basic model <span class="math display">\[fte_{it}=\beta_0+\beta_1nj_i+\beta_2d_i+\beta_3(nj_i\times d_i) + \epsilon_{it}\]</span> where <span class="math inline">\(fte_i\)</span> is full-time equivalent employees, <span class="math inline">\(nj_i\)</span> is the treatment<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>, and <span class="math inline">\(d_i\)</span> is the after dummy<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>. Since <span class="math inline">\(\beta_3\)</span> is the difference in differences of treated and control states, test the hypothesis: <span class="math display">\[H_0:\beta_3=0\]</span><span class="math display">\[H_1:\beta_3\ne0\]</span></p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" title="1"><span class="co"># Call the following only once.</span></a>
<a class="sourceLine" id="cb265-2" title="2"><span class="co"># install.packages(&quot;devtools&quot;) # required to insall GitHub packages do this only once</span></a>
<a class="sourceLine" id="cb265-3" title="3"><span class="co"># devtools::install_git(&quot;https://github.com/ccolonescu/PoEdata&quot;) # install the package from GitHub </span></a></code></pre></div>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" title="1"><span class="kw">library</span>(PoEdata)</a>
<a class="sourceLine" id="cb266-2" title="2"><span class="kw">data</span>(njmin3)</a>
<a class="sourceLine" id="cb266-3" title="3">njmin3 <span class="op">%$%</span></a>
<a class="sourceLine" id="cb266-4" title="4"><span class="st">  </span><span class="kw">lm</span>(fte <span class="op">~</span><span class="st"> </span>nj<span class="op">*</span>d) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb266-5" title="5"><span class="st">  </span><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>
Call:
lm(formula = fte ~ nj * d)

Residuals:
   Min     1Q Median     3Q    Max 
-21.17  -6.44  -1.03   4.47  64.56 

Coefficients:
            Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept)    23.33       1.07   21.77 &lt;0.0000000000000002 ***
nj             -2.89       1.19   -2.42               0.016 *  
d              -2.17       1.52   -1.43               0.154    
nj:d            2.75       1.69    1.63               0.103    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 9.41 on 790 degrees of freedom
  (26 observations deleted due to missingness)
Multiple R-squared:  0.0074,    Adjusted R-squared:  0.00363 
F-statistic: 1.96 on 3 and 790 DF,  p-value: 0.118</code></pre>
<p>At the <span class="math inline">\(\alpha=.05\)</span> level of significance the t-statistic with 790 degrees of freedom is <span class="math inline">\(\pm\)</span> <span class="math inline">\(1.963\)</span>. The calculated t-statistic is 1.631 so we fail to reject the null hypothesis and conclude that there is no evidence to suggest that the change in the minimum wage changed full-time employment.</p>
<p>We control for other variables below</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" title="1">njmin3 <span class="op">%$%</span></a>
<a class="sourceLine" id="cb268-2" title="2"><span class="st">  </span><span class="kw">lm</span>(fte <span class="op">~</span><span class="st"> </span>nj<span class="op">*</span>d <span class="op">+</span><span class="st"> </span>co_owned) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb268-3" title="3"><span class="st">  </span><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>
Call:
lm(formula = fte ~ nj * d + co_owned)

Residuals:
   Min     1Q Median     3Q    Max 
-22.06  -6.34  -1.06   4.56  66.29 

Coefficients:
            Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)   24.293      1.093   22.24 &lt; 0.0000000000000002 ***
nj            -2.939      1.184   -2.48              0.01323 *  
d             -2.234      1.503   -1.49              0.13759    
co_owned      -2.645      0.696   -3.80              0.00015 ***
nj:d           2.820      1.674    1.68              0.09255 .  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 9.33 on 789 degrees of freedom
  (26 observations deleted due to missingness)
Multiple R-squared:  0.0253,    Adjusted R-squared:  0.0203 
F-statistic: 5.11 on 4 and 789 DF,  p-value: 0.000454</code></pre>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="6">
<li id="fn6"><p>The base case can be changed from the default with appropriate arguments see the <a href="https://forcats.tidyverse.org/">forcats</a> package for more.<a href="chp8.html#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>Please note that not all of the coefficients are significant at the 5% level. This is ignored in the equations derived for expository purposes. In fact, we can see that the slope coefficients for Oakland, Sacramento, and San Francisco are not significantly different from the slope coefficient for Fresno, since each of those interaction effects are not significant.<a href="chp8.html#fnref7" class="footnote-back">↩</a></p></li>
<li id="fn8"><p>The PoEdata package is not housed at CRAN, instead it is house at GitHub, so installing it requires an extra step.<a href="chp8.html#fnref8" class="footnote-back">↩</a></p></li>
<li id="fn9"><p><span class="math inline">\(nj_i\)</span> takes the value 1 for New Jersey where the minimum wage was increased and the value 0 for Pennsylvania where the minimum wage was not changed<a href="chp8.html#fnref9" class="footnote-back">↩</a></p></li>
<li id="fn10"><p><span class="math inline">\(d_1\)</span> takes the value 1 after the minimum wage is changed and the value 0 before the change.<a href="chp8.html#fnref10" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chp7.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chp9.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["bailey.pdf", "bailey.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
